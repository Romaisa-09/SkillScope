{% extends 'base.html' %}

{% block title %}{{ job.title }} at {{ job.company.name }} - SkillScope{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'jobs' %}">Jobs</a></li>
            <li class="breadcrumb-item active">{{ job.title }}</li>
        </ol>
    </nav>
    
    <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
            <div class="job-card">
                <!-- Job Header -->
                <div class="d-flex mb-4">
                    <div class="company-logo" style="width: 80px; height: 80px; font-size: 2rem;">
                        {{ job.company.name|slice:":1"|upper }}
                    </div>
                    <div class="flex-grow-1">
                        <h2>{{ job.title }}</h2>
                        <h5 class="company-name">
                            <i class="bi bi-building"></i> {{ job.company.name }}
                        </h5>
                        <div class="mt-2">
                            <span class="job-badge primary">
                                <i class="bi bi-geo-alt"></i> {{ job.location|default:"Remote" }}
                            </span>
                            <span class="job-badge success">
                                <i class="bi bi-briefcase"></i> {{ job.get_job_type_display }}
                            </span>
                            <span class="job-badge warning">
                                <i class="bi bi-star"></i> {{ job.get_experience_level_display }}
                            </span>
                            {% if job.salary_min %}
                            <span class="job-badge" style="background: rgba(34, 197, 94, 0.1); color: #16A34A;">
                                <i class="bi bi-currency-dollar"></i> {{ job.get_salary_range }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Job Stats -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded">
                            <i class="bi bi-calendar3"></i> <strong>Posted:</strong><br>
                            {{ job.posted_date|date:"M d, Y" }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded">
                            <i class="bi bi-eye"></i> <strong>Views:</strong><br>
                            {{ job.views }}
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="p-3 bg-light rounded">
                            <i class="bi bi-clock-history"></i> <strong>Status:</strong><br>
                            <span class="text-success">Active</span>
                        </div>
                    </div>
                </div>
                
                <!-- Job Description -->
                <div class="mb-4">
                    <h4><i class="bi bi-file-text"></i> Job Description</h4>
                    <hr>
                    <div style="white-space: pre-line; line-height: 1.8;">{{ job.description }}</div>
                </div>
                
                <!-- Required Skills -->
                <div class="mb-4">
                    <h4><i class="bi bi-code-slash"></i> Required Skills</h4>
                    <hr>
                    <div>
                        {% for skill in job.skills.all %}
                            <span class="skill-tag" style="padding: 8px 16px; font-size: 0.9rem; margin: 5px;">
                                {{ skill.name }}
                            </span>
                        {% empty %}
                            <p class="text-muted">No specific skills listed</p>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Tags -->
                {% if job.tags %}
                <div class="mb-4">
                    <h4><i class="bi bi-tags"></i> Tags</h4>
                    <hr>
                    <div>
                        <p class="text-muted">{{ job.tags }}</p>
                    </div>
                </div>
                {% endif %}
                
                <!-- Apply Button -->
                <div class="text-center mt-4 p-4" style="background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%); border-radius: 15px;">
                    <h4 class="text-white mb-3">Interested in this position?</h4>
                    <a href="{{ job.external_url }}" target="_blank" class="btn btn-light btn-lg">
                        <i class="bi bi-box-arrow-up-right"></i> Apply on {{ job.source.name }}
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Company Info -->
            <div class="job-card mb-4">
                <h5><i class="bi bi-building"></i> About the Company</h5>
                <hr>
                <div class="text-center mb-3">
                    <div class="company-logo mx-auto" style="width: 80px; height: 80px; font-size: 2rem;">
                        {{ job.company.name|slice:":1"|upper }}
                    </div>
                </div>
                <h6 class="text-center">{{ job.company.name }}</h6>
                <p class="text-muted">{{ job.company.description|truncatewords:30 }}</p>
                
                {% if job.company.website %}
                <a href="{{ job.company.website }}" target="_blank" class="btn btn-outline-primary btn-sm w-100">
                    <i class="bi bi-globe"></i> Visit Website
                </a>
                {% endif %}
            </div>
            
            <!-- Quick Stats -->
            <div class="job-card mb-4">
                <h5><i class="bi bi-info-circle"></i> Quick Stats</h5>
                <hr>
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="bi bi-briefcase text-primary"></i> 
                        <strong>Job Type:</strong> {{ job.get_job_type_display }}
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-star text-warning"></i> 
                        <strong>Level:</strong> {{ job.get_experience_level_display }}
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-geo-alt text-success"></i> 
                        <strong>Location:</strong> {{ job.location|default:"Remote Worldwide" }}
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-calendar text-info"></i> 
                        <strong>Posted:</strong> {{ job.posted_date|timesince }} ago
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-eye text-secondary"></i> 
                        <strong>Views:</strong> {{ job.views }}
                    </li>
                </ul>
            </div>
            
            <!-- Share -->
            <div class="job-card">
                <h5><i class="bi bi-share"></i> Share This Job</h5>
                <hr>
                <div class="d-grid gap-2">
                    <a href="https://twitter.com/intent/tweet?text={{ job.title }} at {{ job.company.name }}&url={{ request.build_absolute_uri }}" 
                       target="_blank" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-twitter"></i> Share on Twitter
                    </a>
                    <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ request.build_absolute_uri }}" 
                       target="_blank" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-linkedin"></i> Share on LinkedIn
                    </a>
                    <button onclick="copyToClipboard()" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-clipboard"></i> Copy Link
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Similar Jobs -->
    {% if similar_jobs %}
    <div class="mt-5">
        <h3 class="mb-4"><i class="bi bi-lightbulb"></i> Similar Opportunities</h3>
        <div class="row">
            {% for similar in similar_jobs %}
            <div class="col-md-6 col-lg-3">
                <div class="job-card">
                    <div class="text-center mb-3">
                        <div class="company-logo mx-auto">
                            {{ similar.company.name|slice:":1"|upper }}
                        </div>
                    </div>
                    <h6 class="text-center">{{ similar.title|truncatewords:5 }}</h6>
                    <p class="text-center company-name">{{ similar.company.name }}</p>
                    <div class="text-center">
                        <span class="job-badge primary" style="font-size: 0.75rem;">
                            {{ similar.location|default:"Remote" }}
                        </span>
                    </div>
                    <a href="{% url 'job_detail' similar.id %}" class="btn btn-sm btn-primary-custom w-100 mt-3">
                        View Details
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script>
function copyToClipboard() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
        alert('Link copied to clipboard!');
    });
}
</script>
{% endblock %}