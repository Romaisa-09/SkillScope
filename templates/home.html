{% extends 'base.html' %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="fade-in-up">Discover Your Next Career Move</h1>
                <p class="fade-in-up">Track job trends, analyze market demands, and find opportunities that match your skills</p>
                
                <div class="search-box fade-in-up">
                    <form method="GET" action="{% url 'jobs' %}" class="row g-2">
                        <div class="col-md-5">
                            <input type="text" name="search" class="form-control" placeholder="Job title or keyword...">
                        </div>
                        <div class="col-md-4">
                            <input type="text" name="location" class="form-control" placeholder="Location...">
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-success w-100">
                                <i class="bi bi-search"></i> Search Jobs
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Stats Section -->
<section class="container my-5">
    <div class="row">
        <div class="col-md-3">
            <div class="stat-card fade-in-up">
                <div class="icon blue">
                    <i class="bi bi-briefcase"></i>
                </div>
                <h3>{{ total_jobs }}</h3>
                <p>Active Job Listings</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card fade-in-up" style="animation-delay: 0.1s">
                <div class="icon green">
                    <i class="bi bi-building"></i>
                </div>
                <h3>{{ total_companies }}</h3>
                <p>Companies Hiring</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card fade-in-up" style="animation-delay: 0.2s">
                <div class="icon orange">
                    <i class="bi bi-code-slash"></i>
                </div>
                <h3>{{ total_skills }}</h3>
                <p>Skills Tracked</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card fade-in-up" style="animation-delay: 0.3s">
                <div class="icon red">
                    <i class="bi bi-geo-alt"></i>
                </div>
                <h3>{{ total_locations }}</h3>
                <p>Locations Covered</p>
            </div>
        </div>
    </div>
</section>

<!-- Top Skills Section -->
<section class="container my-5">
    <h2 class="text-center mb-4">ðŸ”¥ Top Demanded Skills</h2>
    <div class="chart-container">
        <canvas id="topSkillsChart"></canvas>
    </div>
</section>

<!-- Recent Jobs Section -->
<section class="container my-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Latest Job Postings</h2>
        <a href="{% url 'jobs' %}" class="btn btn-primary-custom">View All Jobs <i class="bi bi-arrow-right"></i></a>
    </div>
    
    <div class="row">
        {% for job in recent_jobs %}
        <div class="col-md-6">
            <div class="job-card">
                <div class="d-flex">
                    <div class="company-logo">
                        {{ job.company.name|slice:":1"|upper }}
                    </div>
                    <div class="flex-grow-1">
                        <h5>{{ job.title }}</h5>
                        <p class="company-name">
                            <i class="bi bi-building"></i> {{ job.company.name }}
                        </p>
                    </div>
                </div>
                
                <div class="mb-3">
                    <span class="job-badge primary">
                        <i class="bi bi-geo-alt"></i> {{ job.location|default:"Remote" }}
                    </span>
                    <span class="job-badge success">
                        <i class="bi bi-briefcase"></i> {{ job.get_job_type_display }}
                    </span>
                    <span class="job-badge warning">
                        <i class="bi bi-star"></i> {{ job.get_experience_level_display }}
                    </span>
                </div>
                
                <div class="mb-3">
                    {% for skill in job.skills.all|slice:":5" %}
                        <span class="skill-tag">{{ skill.name }}</span>
                    {% endfor %}
                </div>
                
                <div class="d-flex justify-content-between align-items-center">
                    <small class="text-muted">
                        <i class="bi bi-clock"></i> {{ job.posted_date|timesince }} ago
                    </small>
                    <a href="{% url 'job_detail' job.id %}" class="btn btn-sm btn-primary-custom">
                        View Details <i class="bi bi-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info text-center">
                <i class="bi bi-info-circle"></i> No jobs available yet. Run the scraper to fetch jobs!
            </div>
        </div>
        {% endfor %}
    </div>
</section>

<!-- CTA Section -->
<section class="container my-5">
    <div class="text-center p-5" style="background: linear-gradient(135deg, #4F46E5 0%, #6366F1 100%); border-radius: 20px; color: white;">
        <h2 class="mb-3">Ready to Explore Market Insights?</h2>
        <p class="mb-4">Dive deep into job market analytics and trends</p>
        <a href="{% url 'analytics' %}" class="btn btn-light btn-lg">
            <i class="bi bi-graph-up"></i> View Analytics Dashboard
        </a>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
// Top Skills Chart
const ctx = document.getElementById('topSkillsChart').getContext('2d');
const topSkillsChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ top_skills_labels|safe }},
        datasets: [{
            label: 'Number of Jobs',
            data: {{ top_skills_data|safe }},
            backgroundColor: [
                'rgba(79, 70, 229, 0.8)',
                'rgba(16, 185, 129, 0.8)',
                'rgba(245, 158, 11, 0.8)',
               'rgba(239, 68, 68, 0.8)',
                'rgba(139, 92, 246, 0.8)',
                'rgba(6, 182, 212, 0.8)',
                'rgba(236, 72, 153, 0.8)',
                'rgba(132, 204, 22, 0.8)'
            ],
            borderRadius: 8,
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: false
            },
            title: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    }
});
</script>
{% endblock %}