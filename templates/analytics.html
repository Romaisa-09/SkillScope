{% extends 'base.html' %}

{% block title %}Analytics Dashboard - SkillScope{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section" style="padding: 60px 0;">
    <div class="container">
        <div class="text-center">
            <h1><i class="bi bi-graph-up"></i> Job Market Analytics</h1>
            <p>Deep insights into job market trends and demands</p>
        </div>
    </div>
</section>

<div class="container my-5">
    <!-- Overview Stats -->
    <div class="row mb-5">
        <div class="col-md-3">
            <div class="stat-card">
                <div class="icon blue">
                    <i class="bi bi-briefcase"></i>
                </div>
                <h3>{{ total_jobs }}</h3>
                <p>Total Active Jobs</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="icon green">
                    <i class="bi bi-currency-dollar"></i>
                </div>
                <h3>${{ avg_salary|floatformat:0 }}</h3>
                <p>Average Salary (USD)</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="icon orange">
                    <i class="bi bi-lightning"></i>
                </div>
                <h3>Live</h3>
                <p>Real-time Data</p>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card">
                <div class="icon red">
                    <i class="bi bi-bar-chart"></i>
                </div>
                <h3>7+</h3>
                <p>Key Metrics</p>
            </div>
        </div>
    </div>
    
    <!-- Jobs Posted Over Time -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h4><i class="bi bi-graph-up-arrow"></i> Job Postings Timeline (Last 30 Days)</h4>
                <canvas id="timelineChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Top Skills & Companies -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="bi bi-code-slash"></i> Top 10 Most Demanded Skills</h4>
                <canvas id="skillsChart"></canvas>
            </div>
        </div>
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="bi bi-building"></i> Top 10 Hiring Companies</h4>
                <canvas id="companiesChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Job Type & Experience Distribution -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="bi bi-pie-chart"></i> Jobs by Type</h4>
                <canvas id="jobTypeChart"></canvas>
            </div>
        </div>
        <div class="col-md-6">
            <div class="chart-container">
                <h4><i class="bi bi-star"></i> Jobs by Experience Level</h4>
                <canvas id="experienceChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Top Locations -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="chart-container">
                <h4><i class="bi bi-geo-alt"></i> Top 10 Job Locations</h4>
                <canvas id="locationsChart"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Key Insights -->
    <div class="row">
        <div class="col-12">
            <div class="chart-container" style="background: linear-gradient(135deg, #F0F9FF 0%, #E0F2FE 100%);">
                <h4><i class="bi bi-lightbulb"></i> Key Insights</h4>
                <div class="row mt-4">
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-white rounded shadow-sm">
                            <h5 class="text-primary"><i class="bi bi-trophy"></i> Most In-Demand</h5>
                            <p class="mb-0">Technical skills like Python, JavaScript, and React dominate the job market</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-white rounded shadow-sm">
                            <h5 class="text-success"><i class="bi bi-graph-up"></i> Growing Trend</h5>
                            <p class="mb-0">Remote work opportunities have increased significantly across all sectors</p>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="p-3 bg-white rounded shadow-sm">
                            <h5 class="text-warning"><i class="bi bi-currency-dollar"></i> Salary Range</h5>
                            <p class="mb-0">Senior positions offer 40-60% higher compensation than mid-level roles</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// Color palette
const colors = {
    primary: 'rgba(79, 70, 229, 0.8)',
    secondary: 'rgba(16, 185, 129, 0.8)',
    warning: 'rgba(245, 158, 11, 0.8)',
    danger: 'rgba(239, 68, 68, 0.8)',
    info: 'rgba(6, 182, 212, 0.8)',
    purple: 'rgba(139, 92, 246, 0.8)',
    pink: 'rgba(236, 72, 153, 0.8)',
    green: 'rgba(132, 204, 22, 0.8)',
};

const chartColors = [
    colors.primary, colors.secondary, colors.warning, colors.danger,
    colors.info, colors.purple, colors.pink, colors.green,
    'rgba(251, 146, 60, 0.8)', 'rgba(14, 165, 233, 0.8)'
];

// Timeline Chart
const timelineCtx = document.getElementById('timelineChart').getContext('2d');
new Chart(timelineCtx, {
    type: 'line',
    data: {
        labels: {{ timeline_labels|safe }},
        datasets: [{
            label: 'Jobs Posted',
            data: {{ timeline_data|safe }},
            borderColor: colors.primary,
            backgroundColor: 'rgba(79, 70, 229, 0.1)',
            tension: 0.4,
            fill: true,
            borderWidth: 3,
            pointRadius: 4,
            pointBackgroundColor: colors.primary,
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    }
});

// Skills Chart
const skillsCtx = document.getElementById('skillsChart').getContext('2d');
new Chart(skillsCtx, {
    type: 'bar',
    data: {
        labels: {{ skills_labels|safe }},
        datasets: [{
            label: 'Number of Jobs',
            data: {{ skills_data|safe }},
            backgroundColor: chartColors,
            borderRadius: 8,
            borderWidth: 0
        }]
    },
    options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            x: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            y: {
                grid: {
                    display: false
                }
            }
        }
    }
});

// Companies Chart
const companiesCtx = document.getElementById('companiesChart').getContext('2d');
new Chart(companiesCtx, {
    type: 'bar',
    data: {
        labels: {{ companies_labels|safe }},
        datasets: [{
            label: 'Number of Jobs',
            data: {{ companies_data|safe }},
            backgroundColor: chartColors,
            borderRadius: 8,
            borderWidth: 0
        }]
    },
    options: {
        indexAxis: 'y',
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            x: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            y: {
                grid: {
                    display: false
                }
            }
        }
    }
});

// Job Type Chart (Doughnut)
const jobTypeCtx = document.getElementById('jobTypeChart').getContext('2d');
new Chart(jobTypeCtx, {
    type: 'doughnut',
    data: {
        labels: {{ job_type_labels|safe }},
        datasets: [{
            data: {{ job_type_data|safe }},
            backgroundColor: chartColors,
            borderWidth: 0,
            hoverOffset: 10
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 20,
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
});

// Experience Chart (Pie)
const experienceCtx = document.getElementById('experienceChart').getContext('2d');
new Chart(experienceCtx, {
    type: 'pie',
    data: {
        labels: {{ experience_labels|safe }},
        datasets: [{
            data: {{ experience_data|safe }},
            backgroundColor: [colors.primary, colors.secondary, colors.warning, colors.danger],
            borderWidth: 0,
            hoverOffset: 10
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    padding: 20,
                    font: {
                        size: 12
                    }
                }
            }
        }
    }
});

// Locations Chart
const locationsCtx = document.getElementById('locationsChart').getContext('2d');
new Chart(locationsCtx, {
    type: 'bar',
    data: {
        labels: {{ locations_labels|safe }},
        datasets: [{
            label: 'Number of Jobs',
            data: {{ locations_data|safe }},
            backgroundColor: chartColors,
            borderRadius: 8,
            borderWidth: 0
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                grid: {
                    color: 'rgba(0, 0, 0, 0.05)'
                }
            },
            x: {
                grid: {
                    display: false
                }
            }
        }
    }
});
</script>
{% endblock %}